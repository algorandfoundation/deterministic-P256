# DeterministicP256 - Deterministically generate P-256 (Secp256r1) credentials

A small library created for [Liquid Auth Android](https://github.com/algorandfoundation/liquid-auth-android) allowing users to specify a BIP39-compliant mnemonic, ran through a PBKDF2, to produce a root seed that can then be used to generate other passkeys for FIDO2.

This allows a user to regenerate passkeys created for specific domains (e.g., GitHub.com) and userIds anew, across platforms and devices. The alternative is to either keep the passkeys device-bound, or to rely on Google or Apple to custody the keys on-behalf of the user.

# Flow

```kotlin

val DP256 = DeterministicP256()

// Generate the root seed by passing along a BIP39 mnemonic:

val rootSeed = DP256.genRootSeedWithBIP39("salon zoo engage submit smile frost later decide wing sight chaos renew lizard rely canal coral scene hobby scare step bus leaf tobacco slice")
```

The function `genRootSeedWithBIP39(.)` validates the mnemonic, that the words are 1) valid according to the [wordlist](https://github.com/bitcoin/bips/blob/master/bip-0039/bip-0039-wordlists.md). 2) that the checksum (final word) is correct.

It wraps around the private function `genRootSeed` which in turn calls PBKDF2-HMAC-SHA512. By default, the salt is `liquid`(in bytes), iterator count is 600000 and key length 512 (64 bytes).

A `rootSeed`is returned from this function. In the context of generating P-256 passkeys, the mnemonic should be safely stored off-device and never stored on it; a user can supply it if needed (e.g., if the device's storage gets wiped). It is enough to store the rootSeed.

A domain (website) and user-specific P-256 keyPair can now be generate, for use in a FIDO2-compliant passkey sign-in flow.

```kotlin
// Example values taken from: https://webauthn.guide/#registration
val origin = "https://webauthn.guide"
val userId = "a2bd8bf7-2145-4a5a-910f-8fdc9ef421d3"

val keyPair = DP256.genDomainSpecificKeypair(rootSeed, origin, userId)
```

Optionally, `genDomainSpecificKeypair()` also takes a counter Int value (by default it is counter = 0). This allows for multiple passkeys to be generated for a specific domain and userId, by incrementing the counter.

Under the hood, the seed for the keyPair is generated by computing `SHA512(rootSeed || origin || userId)` where || refers to a concatenation of the bytes.

# LICENSE

Copyright 2024 Algorand Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
